# Scenario parameters

In the Scenario view, the bottom-panel represents the parameters that users can modify before running a scenario. These
parameters can be grouped into several tabs, and although a default grouping and layout is generated by the webapp, you
can change these by modifying the
[ScenarioParameters.js configuration file](../src/config/ScenarioParameters.js)

## Default tabs

By default, scenario parameters tabs will be generated by the webapp based on the data provided in your solution
description (e.g. the file *Solution.yaml* that you used to create your Cosmo Tech solution). This means that in most
cases, for a first setup of your application, you don't have to add anything in the scenario parameters configuration
file.

Your solution description must contain at least these three sets of information for the tabs to be generated:
* `parameters`: a list of **parameter** objects with these properties:
  * `id`
  * `varType`: supported types are **enum**, **string**, **int**, **number**, **bool**, **date**, **%DATASETID%**
  * `defaultValue` (optional)
  * `minValue` (optional)
  * `maxValue` (optional)
  * `labels`: a dict of labels for this parameter, the keys of the dict being the code ISO 639-1 of the language, and
  the values being the corresponding label (optional)
* `parameterGroups`: a list of **parameters group** objects with these properties:
  * `id`
  * `parameters` fields to list the ids of the parameters that are part of this group
  * `labels`: a dict of labels for this parameter group, the keys of the dict being the code ISO 639-1 of the language,
  and the values being the corresponding label (optional)
* `runTemplates`: a list of **run template** objects with these properties:
  * `id`
  * `parameterGroups` fields to list the ids of the groups of parameters to be displayed for this run template

*Note: To get the full documentation of the solution description data, please refer to the
[Cosmo Tech API documentation](https://github.com/Cosmo-Tech/cosmotech-api/blob/main/doc/Models/Solution.md). Please
note though that some fields documented in the Solution description may not be used yet in the web-app (e.g. the
`regexValidation` field of parameters).*

Because each scenario is associated to a run template when it is created, the webapp can determine the groups of
parameters to display for each one. A tab is generated for each parameter group, and this tab contains one input
component for each parameter of this group. **The type of input component rendered and its behavior depends on the
varType of the parameter**.

## Customization by configuration

The [ScenarioParameters.js configuration file](../src/config/ScenarioParameters/ScenarioParameters.js) lets you override
all the values defined in your solution description. Please keep in mind though that changing some data *via* this
configuration file such as the variable types of parameters or the set of parameters associated to a run template might
break things. Yet it is totally safe to use this configuration file to customize the following behaviors:
* changing translation labels of parameters, parameters groups
* changing the min, max and default values of parameters
* modifying the order of parameters in a group, or the order of the parameters groups tabs
* defining the possible values of a parameter of type *enum*
* add `data-cy` properties to the input components for Cypress tests

If you don't need to customize any of these, you don't nedd to edit the configuration file and can use its default
content:

```
const PARAMETERS = {};
const PARAMETERS_GROUPS = {};
const RUN_TEMPLATES = {};

export const SCENARIO_PARAMETERS_CONFIG = {
  parameters: PARAMETERS,
  parametersGroups: PARAMETERS_GROUPS,
  runTemplates: RUN_TEMPLATES
};
```

### Customize translation labels

The constants `PARAMETERS` and `PARAMETERS_GROUPS` of the configuration file can be used to change the labels of
parameters and parameters groups, by adding a field `labels` in the object that describe them. Note that you don't have
to rewrite all data that are already in your solution description if you only want to change a part of them.

The example below illustrates how to changes the labels of a parameter and a parameter group:

```
const PARAMETERS = {
  nb_waiters: {
    labels: {
      en: 'Waiters number',
      fr: 'Nombre de serveurs'
    }
  },
  restock_qty: {
    labels: {
      en: 'Restock quantity',
      fr: 'Seuil de réapprovisionnement'
    }
  },
  stock: {
    labels: {
      en: 'Stock',
      fr: 'Stock'
    }
  },
};

const PARAMETERS_GROUPS = {
  bar_parameters: {
    labels: {
      en: 'My pub',
      fr: 'Mon bar'
    }
  }
};
```

These labels will be loaded into the i18next translation dictionary used for translating most labels of the webapp. If
you are writing your own input components and want to use these labels, you can retrieve them by reading the translation
keys `solution.parameters.[PARAMETER_ID]` and `solution.parametersGroups.[PARAMETER_GROUP_ID]`.

### Customize parameters min, max & default values

In the configuration file, you can use the `PARAMETERS` constant to override the properties `minValue`, `maxValue` and
`defaultValue` of the parameters. Note that you don't have to rewrite all data that are already in your solution
description if you only want to change a part of them.

Example:

```
const PARAMETERS = {
  nb_waiters: {
    minValue: 2,
    maxValue: 20,
    defaultValue: 5
  },
  restock_qty: {
    minValue: 0,
    defaultValue: 25
  },
  stock: {
    minValue: 0,
    defaultValue: 100
  },
};
```

### Customize the order of parameters & parameters groups

By default, the orders of the parameters input components in a group follow the order they are defined in the solution
description. If you want to change this order in the configuration file, you just need to re-order them in the field
`parameters` of the parameter groups:

```
const PARAMETERS_GROUPS = {
  bar_parameters: {
    parameters: [ // Change the order of the parameters in this list
      'stock',
      'restock_qty',
      'nb_waiters'
    ]
  },
};
```

The same goes for the order of the tabs representing the parameters groups: you can change this order by re-ordering the
groups in the field `parameterGroups` of the run templates:

```
const RUN_TEMPLATES = {
  standardSimulationRunTemplate: {
    // Note: use 'parameterGroups' instead of 'parametersGroups' in the run templates description
    // to be consistent with back-end format
    parameterGroups: [ // Change the order of the parameters groups in this list
      'bar_parameters',
      'basic_types',
      'file_upload'
    ]
  }
};
```

### Configure parameters of type enum

When using a scenario parameter of type enum, you have to declare in the webapp configuration the list of possible
values the enum can take, and the labels that will displayed in the front-end interface for each value. This can be done
in the `PARAMETERS` constant of the scenario parameters configuration, by adding the field `enumValues` in the object
representing your parameter, where `enmValues` is a list of objects with two properties:
* key: the string-based representation of your enum value, that will be sent to the parameters handler
* value: the label that will be displayed for this key in the selection list of the enum input component

Example:

```
const PARAMETERS = {
  currency: {
    defaultValue: 'USD',
    enumValues: [
      {
        key: 'USD',
        value: '$'
      },
      {
        key: 'EUR',
        value: '€'
      },
      {
        key: 'BTC',
        value: '฿'
      },
      {
        key: 'JPY',
        value: '¥'
      }
    ]
  }
};
```

### Configure input components for Cypress tests

If you want to add Cypress tests for your solution and test the scenario parameters input components, you can add a
`dataCy` field in the parameter object in your configuration file with a string value. This value will then be added as
a `data-cy` property in the input component generated by the webapp. You will then be able to use it as a selector in
your Cypress tests.

Example:

```
const PARAMETERS = {
  nb_waiters: {
    dataCy: 'waiters-input',
  },
  restock_qty: {
    dataCy: 'restock-input',
  },
  stock: {
    dataCy: 'stock-input',
  }
};
```

## File upload

See documentation in [File upload](fileUpload.md).
