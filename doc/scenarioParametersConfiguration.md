# Scenario parameters

In the Scenario view, the bottom-panel represents the parameters that users can modify before running a scenario. These
parameters can be grouped into several tabs, and although a default grouping and layout is generated by the webapp, you
can change these by modifying the
[ScenarioParameters.js configuration file](../src/config/ScenarioParameters.js)

## Default tabs

By default, scenario parameters tabs will be generated by the webapp based on the data provided in your solution
description (e.g. the file _Solution.yaml_ that you used to create your Cosmo Tech solution). This means that in most
cases, for a first setup of your application, you don't have to add anything in the [scenario parameters configuration
file](../src/config/ScenarioParameters.js).

Your solution description must contain at least these three sets of information for the tabs to be generated:

- `parameters`: a list of **parameter** objects with these properties:
  - `id`
  - `varType`: supported types are **enum**, **string**, **int**, **number**, **bool**, **date**, **%DATASETID%**
  - `defaultValue` (optional)
  - `minValue` (optional)
  - `maxValue` (optional)
  - `labels`: a dict of labels for this parameter, the keys of the dict being the code ISO 639-1 of the language, and
    the values being the corresponding label (optional)
- `parameterGroups`: a list of **parameters group** objects with these properties:
  - `id`
  - `parameters` fields to list the ids of the parameters that are part of this group
  - `labels`: a dict of labels for this parameter group, the keys of the dict being the code ISO 639-1 of the language,
    and the values being the corresponding label (optional)
  - `authorizedRoles` : an array of [APP_ROLES](../src/config/Profiles.js) allowed to see the scenario parameters tab(optional). By default, all tabs are visible
  - `hideParameterGroupIfNoPermission`: a boolean value that indicates, when the connected user has no sufficient roles to see the scenario parameters tab, if tab should be displayed or not (optional).
    By default, the scenario parameter tab is visible
- `runTemplates`: a list of **run template** objects with these properties:
  - `id`
  - `parameterGroups` fields to list the ids of the groups of parameters to be displayed for this run template

_Note: To get the full documentation of the solution description data, please refer to the
[Cosmo Tech API documentation](https://github.com/Cosmo-Tech/cosmotech-api/blob/main/doc/Models/Solution.md). Please
note though that some fields documented in the Solution description may not be used yet in the web-app (e.g. the
`regexValidation` field of parameters)._

Because each scenario is associated to a run template when it is created, the webapp can determine the groups of
parameters to display for each one. A tab is generated for each parameter group, and this tab contains one input
component for each parameter of this group. **The type of input component rendered and its behavior depends on the
varType of the parameter**.

## Configuration

The [ScenarioParameters.js configuration file](../src/config/ScenarioParameters/ScenarioParameters.js) lets you override
all the values defined in your solution description. Please keep in mind though that changing some data _via_ this
configuration file such as the variable types of parameters or the set of parameters associated to a run template might
break things. Yet it is totally safe to use it to modify the following behaviors:

- changing translation labels of parameters, parameters groups
- changing the min, max and default values of parameters
- modifying the order of parameters in a group, or the order of the parameters groups tabs
- defining the possible values of a parameter of type _enum_
- add `data-cy` properties to the input components for Cypress tests

If you don't need changes for these behaviors, you don't nedd to edit the configuration file and can use its default
content:

```
const PARAMETERS = {};
const PARAMETERS_GROUPS = {};
const RUN_TEMPLATES = {};

export const SCENARIO_PARAMETERS_CONFIG = {
  parameters: PARAMETERS,
  parametersGroups: PARAMETERS_GROUPS,
  runTemplates: RUN_TEMPLATES
};
```

### Translation labels

The constants `PARAMETERS` and `PARAMETERS_GROUPS` of the configuration file can be used to change the labels of
parameters and parameters groups, by adding a field `labels` in the object that describe them. Note that you don't have
to rewrite all data that are already in your solution description if you only want to change a part of them.

The example below illustrates how to changes the labels of a parameter and a parameter group:

```
const PARAMETERS = {
  nb_waiters: {
    labels: {
      en: 'Waiters number',
      fr: 'Nombre de serveurs'
    }
  },
  restock_qty: {
    labels: {
      en: 'Restock quantity',
      fr: 'Seuil de réapprovisionnement'
    }
  },
  stock: {
    labels: {
      en: 'Stock',
      fr: 'Stock'
    }
  },
};

const PARAMETERS_GROUPS = {
  bar_parameters: {
    labels: {
      en: 'My pub',
      fr: 'Mon bar'
    }
  }
};
```

These labels will be loaded into the i18next translation dictionary used for translating most labels of the webapp. If
you are writing your own input components and want to use these labels, you can retrieve them by reading the translation
keys `solution.parameters.[PARAMETER_ID]` and `solution.parametersGroups.[PARAMETER_GROUP_ID]`.

### Parameters min, max & default values

In the configuration file, you can use the `PARAMETERS` constant to override the properties `minValue`, `maxValue` and
`defaultValue` of the parameters. Note that you don't have to rewrite all data that are already in your solution
description if you only want to change a part of them.

Example:

```
const PARAMETERS = {
  nb_waiters: {
    minValue: 2,
    maxValue: 20,
    defaultValue: 5
  },
  restock_qty: {
    minValue: 0,
    defaultValue: 25
  },
  stock: {
    minValue: 0,
    defaultValue: 100
  },
};
```

### Order of parameters & parameters groups

By default, the orders of the parameters input components in a group follow the order they are defined in the solution
description. If you want to change this order in the configuration file, you just need to re-order them in the field
`parameters` of the parameter groups:

```
const PARAMETERS_GROUPS = {
  bar_parameters: {
    parameters: [ // Change the order of the parameters in this list
      'stock',
      'restock_qty',
      'nb_waiters'
    ]
  },
};
```

The same goes for the order of the tabs representing the parameters groups: you can change this order by re-ordering the
groups in the field `parameterGroups` of the run templates:

```
const RUN_TEMPLATES = {
  standardSimulationRunTemplate: {
    // Note: use 'parameterGroups' instead of 'parametersGroups' in the run templates description
    // to be consistent with back-end format
    parameterGroups: [ // Change the order of the parameters groups in this list
      'bar_parameters',
      'basic_types',
      'file_upload'
    ]
  }
};
```

### Parameters of type enum

When using a scenario parameter of type enum, you have to declare in the webapp configuration the list of possible
values the enum can take, and the labels that will displayed in the front-end interface for each value. This can be done
in the `PARAMETERS` constant of the scenario parameters configuration, by adding the field `enumValues` in the object
representing your parameter, where `enmValues` is a list of objects with two properties:

- `key`: the string-based representation of your enum value, that will be sent to the parameters handler
- `value`: the label that will be displayed for this key in the selection list of the enum input component

Example:

```
const PARAMETERS = {
  currency: {
    defaultValue: 'USD',
    enumValues: [
      {
        key: 'USD',
        value: '$'
      },
      {
        key: 'EUR',
        value: '€'
      },
      {
        key: 'BTC',
        value: '฿'
      },
      {
        key: 'JPY',
        value: '¥'
      }
    ]
  }
};
```

### File parameters

When using a scenario parameter with the _varType_ `%DATASETID%` (e.g. dataset parts), you have to declare some
information about it in the `PARAMETERS` constant of the [scenario parameters configuration
file](../src/config/ScenarioParameters.js):

- `defaultFileTypeFilter`: a comma-separated list of files extensions that will be used as the default filter in users'
  file browser
- `connectorId`: the connector id to use in the dataset object that will be created with the Cosmo Tech API
- `description`: the description to use in the dataset object that will be created with the Cosmo Tech API
- `defaultValue`: if you want to have a default file instead of no file uploaded by default, you can provide the id of an existing dataset in the `defaultValue` property

Example:

```
const PARAMETERS = {
  initial_stock_dataset: {
    connectorId: 'C-xxxxxxxxxx',
    defaultFileTypeFilter: '.zip,.csv,.json,.xls,.xlsx',
    description: 'Initial stock dataset part'
  },
};
```

### Table parameters

#### Description

The sample webapp provides a component to let users edit a data table, with CSV import and export features.

These "Table" scenario parameters use the same _varType_ as the "File" parameters (`%DATASETID%`) in your YAML solution
description, but their attributes in the [scenario parameters configurationfile](../src/config/ScenarioParameters.js)
are slightly different:

- `connectorId`: the connector id to use in the dataset object that will be created with the Cosmo Tech API
- `description`: the description to use in the dataset object that will be created with the Cosmo Tech API
- `subType`: set its value to `TABLE` to make use of the _extended var type_ feature
- `columns`: an array describing the expected columns of the table (see section below "Columns definition")
- `dateFormat`: a string describing the expected format of dates in the table based on
  [date-fns format patterns](https://date-fns.org/v2.25.0/docs/parse) (default: 'yyyy-MM-dd')
- `defaultValue`: if you want to have a default table instead of the default empty table, you can provide the id of an existing dataset in the `defaultValue` property (this dataset must be a CSV file, without header, values separated by commas)

#### Columns definition

The description of the table columns consists of an array of objects with the following attributes:

- **field** (_mandatory_) name of the column
- **type** (_optional_) list of options defining the **value type** and **behavior** of the column (only one value type
  is allowed); authorized options are:
  - **string** (_value type_), this is the default value type if none is provided
  - **int** (_value type_)
  - **number** (_value type_)
  - **enum** (_value type_)
  - **bool** (_value type_)
  - **date** (_value type_)
  - **nonResizable** (_behavior_)
  - **nonEditable** (_behavior_)
  - **nonSortable** (_behavior_)
- **minValue** (_optional_) minimum value accepted on edition (for column types _int_, _number_ and _date_)\*
- **maxValue** (_optional_) maximum value accepted on edition (for column types _int_, _number_ and _date_)\*
- **enumValues** (_optional_) list of known enum values, accepted on edition (for column type _enum_)

\* _minValue_ and _maxValue_ specified for a column with the _date_ type will be provided to the standard JS Date
constructor, mind the date format (ISO format is recommended)

#### Example

```
const PARAMETERS = {
  my_customers_table: {
    connectorId: 'C-xxxxxxxxxx',
    description: 'Customers file',
    subType: 'TABLE',
    dateFormat: 'dd/MM/yyyy',
    columns: [
      { field: 'name', type: ['nonResizable', 'nonEditable', 'nonSortable'] },
      { field: 'age', type: ['int'], minValue: 0, maxValue: 120 },
      { field: 'canDrinkAlcohol', type: ['bool'] },
      {
        field: 'favoriteDrink',
        type: ['enum'],
        enumValues: ['AppleJuice', 'Beer', 'OrangeJuice', 'Wine'],
      },
      { field: 'birthday', type: ['date'], minValue: '1900-01-01', maxValue: new Date().toISOString() },
      { field: 'height', type: ['number'], minValue: 0, maxValue: 2.5 },
    ],
  },
};
```

#### Notes

- defining several times the same field will result in undefined behavior
- setting different value types in the `type` attribute will result in undefined behavior

### Input components metadata for Cypress tests

If you want to add Cypress tests for your solution and test the scenario parameters input components, you can add a
`dataCy` field in the parameter object in your configuration file with a string value. This value will then be added as
a `data-cy` property in the input component generated by the webapp. You will then be able to use it as a selector in
your Cypress tests.

Example:

```
const PARAMETERS = {
  nb_waiters: {
    dataCy: 'waiters-input',
  },
  restock_qty: {
    dataCy: 'restock-input',
  },
  stock: {
    dataCy: 'stock-input',
  }
};
```
