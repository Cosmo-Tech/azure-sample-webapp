# Security

This documentation page describes some security mechanisms used in the webapp.

## Content Security Policy (CSP)

### Goal

The Content Security Policy is a set of whitelist filters that define what kind of content is acceptable when viewing pages in a browser. It can be useful to prevent or mitigate some attacks targeting the client browser, such as XSS attacks. For more information on CSP, you can visit https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP.

### CSP location in the webapp code base

The CSP details are generated by [csp-html-webpack-plugin](https://github.com/slackhq/csp-html-webpack-plugin), and injected in the file **build/index.html** when building the webapp. This plugin helps us prevent using "_unsafe-inline_" scripts (the default behavior for React apps).

You can change the CSP rules by modifying the plugin configuration, in the file [config-overrides.js](../config-overrides.js) in the project root folder.

### CSP rules

#### default-src

- `'none'` the default behavior is to prevent content with unknown type or from unknown origin: this rule is used as fallback for content that doesn't match other rules

#### base-uri

- `'self'` prevent hijacking relative URLs by injecting a `base` tag in the page

#### connect-src

- `'self'` allow connections to the server of the webapp, to load the webapp files or for queries to Azure Functions
- `api.powerbi.com` allow requests to get PowerBI reports data when using SSO mode
- `*.api.cosmotech.com` allow API requests to the Cosmo Tech API (if you're using a different Cosmo Tech API URL,
  replace this value)
- `https://login.microsoftonline.com` allow connection to the Microsoft login endpoint to log in with MSAL library
- `https://dc.services.visualstudio.com` allow tracking API for Application Insights

#### script-src

- `'self'` allow scripts coming from the webapp domain

#### img-src

- `'self'` allow images coming from the webapp domain (e.g. images located in the _public_ folder of the webapp)
- `data:` allow images such as base64 encoded files

#### style-src

- `'self'` allow CSS files sent by the webapp domain
- `'unsafe-inline'` allow styles declared inline

#### font-src

- `data:` allow embed base64 fonts

#### frame-src

- `'self'` required to avoid errors with MSAL authentication
- `blob:` required to authorize file downloads from PowerBI dashboards (e.g. export of scenario results)
- `https://app.powerbi.com` allow iframe for PowerBI
- `https://login.microsoftonline.com` allow iframe to Microsoft login service (required to be able to refresh tokens)

#### manifest-src

- `'self'` allow file manifest.json from the webapp domain
