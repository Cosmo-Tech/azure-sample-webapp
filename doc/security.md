# Security

This documentation page describes some security mechanisms used in the webapp.

## Content Security Policy (CSP)

### Goal

The Content Security Policy is a set of whitelist filters that define what kind of content can be loaded when viewing
pages in a browser. It can be useful to prevent or mitigate some attacks targeting the client browser, such as XSS attacks. For more information on CSP, you can visit https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP.

### CSP location in the webapp code base

The CSP details are generated by [vite-plugin-csp-guard](https://github.com/gzuidhof/vite-plugin-csp-guard), and injected in the generated `index.html` when building the webapp. The same plugin can run in dev mode, depending on the `ENABLE_CSP_IN_DEV_MODE` flag.

You can change the CSP rules by modifying the policy configuration in [config-overrides.js](../config-overrides.js). The Vite plugin configuration lives in [vite.config.mjs](../vite.config.mjs).

### CSP rules

#### default-src

- `'self'` allow content from the webapp origin (fallback for content that does not match other rules)

#### base-uri

- `'self'` prevent hijacking relative URLs by injecting a `base` tag in the page

#### connect-src

- `'self'` allow connections to the webapp origin (static assets and local API calls)

Depending on your integration, you may need to add extra sources, for example:

- `api.powerbi.com` to fetch PowerBI report data in SSO mode
- `*.api.cosmotech.com` to call the Cosmo Tech API (replace with your API host)
- `https://login.microsoftonline.com` for MSAL authentication

#### script-src

- `'self'` allow scripts coming from the webapp domain

#### img-src

- `'self'` allow images coming from the webapp domain (e.g. images located in the _public_ folder of the webapp)
- `data:` allow images such as base64 encoded files

#### style-src

- `'self'` allow CSS files sent by the webapp origin

#### style-src-elem

- `'unsafe-inline'` allow inline styles in style elements (used by some third-party libraries)

#### font-src

- `data:` allow embed base64 fonts

#### frame-src

- `'self'` required to avoid errors with MSAL authentication
- `blob:` required to authorize file downloads from PowerBI dashboards (e.g. export of scenario results)

Depending on your integration, you may need to add extra sources, for example:

- `https://app.powerbi.com` allow iframe for PowerBI
- `https://login.microsoftonline.com` allow iframe to Microsoft login service (required to refresh tokens)

#### manifest-src

- `'self'` allow file manifest.json from the webapp domain

#### object-src

- `'none'` disable plugins and embedded objects
